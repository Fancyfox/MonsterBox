{
  "code": "import EventManager from \"../script/Singleton/EventManager\";\r\nimport GameDefine, { EventName, GameState } from \"../script/Singleton/GameDefine\";\r\nexport default class Camera extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this._start_moving = false;\r\n        Camera.instance = this;\r\n    }\r\n    onAwake() {\r\n        this._camera = this.owner;\r\n        this._cameraPos = this._camera.transform.position.clone();\r\n    }\r\n    onEnable() {\r\n        EventManager.register(EventName.PLAYER_PLANK_CHANGE, this.changeCameraFieldOfView, this);\r\n        EventManager.register(EventName.MINI_GAME_END, this.changeCameraToFinal, this);\r\n    }\r\n    onDisable() {\r\n        EventManager.unRegister(EventName.PLAYER_PLANK_CHANGE, this.changeCameraFieldOfView, this);\r\n        EventManager.unRegister(EventName.MINI_GAME_END, this.changeCameraToFinal, this);\r\n    }\r\n    initPlayerData(player, point) {\r\n        this._target = player;\r\n        this._point = point;\r\n        this._start_moving = false;\r\n        this._camera.fieldOfView = 40;\r\n        this._lookAtTarget(this._target, this._point);\r\n    }\r\n    onLateUpdate() {\r\n        if (Laya.timer.delta > 100) {\r\n            return;\r\n        }\r\n        if (GameDefine.gameState != GameState.Playing) {\r\n            return;\r\n        }\r\n        this._cameraPointTween(this._point, this._target);\r\n        this._lookAtTarget(this._target, this._point);\r\n    }\r\n    _lookAtTarget(target, point) {\r\n        if (!target || !point) {\r\n            return;\r\n        }\r\n        let pos = point.transform.position;\r\n        this._cameraPos.setValue(pos.x, pos.y, pos.z);\r\n        this._camera.transform.position = this._cameraPos;\r\n        this._camera.transform.lookAt(target.transform.position, Laya.Vector3.up);\r\n    }\r\n    _cameraPointTween(point, target) {\r\n        if (!point || this._start_moving || !target) {\r\n            return;\r\n        }\r\n        this._start_moving = true;\r\n        Laya.Tween.clearAll(this._camera);\r\n        Laya.Tween.to(this._camera, { fieldOfView: 40 }, 500, Laya.Ease.linearIn);\r\n        Laya.Tween.to(point.transform, { localPositionZ: -10, localPositionY: 5 }, 1000, null, Laya.Handler.create(this, () => {\r\n        }));\r\n    }\r\n    changeCameraFieldOfView(count) {\r\n        Laya.Tween.clearAll(this._camera);\r\n        let fie = 45 + count / 2;\r\n        if (fie > 80) {\r\n            fie = 80;\r\n        }\r\n        Laya.Tween.to(this._camera, { fieldOfView: fie }, 200, Laya.Ease.linearIn);\r\n    }\r\n    changeCameraToFinal() {\r\n        Laya.Tween.clearAll(this._camera);\r\n        Laya.Tween.to(this._camera, { fieldOfView: 40 }, 1500, Laya.Ease.linearIn);\r\n    }\r\n}\r\nCamera.instance = null;\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/EventManager.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/GameDefine.ts"
  ]
}
