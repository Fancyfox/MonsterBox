{
  "code": "import { Configuration } from \"../../Data/Configuration\";\r\nimport { Constants } from \"../../Data/Constants\";\r\nimport DateUtil from \"../../Util/DateUtil\";\r\nimport TimerUtil from \"../../Util/TimerUtil\";\r\nimport GameRecorderManager from \"./GameRecorderManager\";\r\nexport default class DailyManager {\r\n    constructor() {\r\n        this._dailyTick = -1;\r\n        this._dailyTimer = -1;\r\n        this._leftTime = -1;\r\n    }\r\n    static instance() {\r\n        if (!this._instance) {\r\n            this._instance = new DailyManager();\r\n        }\r\n        return this._instance;\r\n    }\r\n    loadFromCache() {\r\n        const dailyTick = Configuration.instance().getConfigData(Constants.DailyTick);\r\n        if (dailyTick) {\r\n            this._dailyTick = JSON.parse(dailyTick);\r\n        }\r\n        let now = new Date().getTime();\r\n        if (now > this._dailyTick) {\r\n            this._dailyTick = DateUtil.GetNextDay(now).getTime();\r\n            this.saveDailyTicktoCache();\r\n            GameRecorderManager.instance().resetHRecord();\r\n        }\r\n        this._startTimer();\r\n    }\r\n    saveDailyTicktoCache() {\r\n        const data = JSON.stringify(this._dailyTick);\r\n        Configuration.instance().setConfigData(Constants.DailyTick, data);\r\n    }\r\n    _startTimer() {\r\n        TimerUtil.clear(this._dailyTimer);\r\n        let now = new Date().getTime();\r\n        this._leftTime = DateUtil.GetNextDay(new Date()).getTime() - now;\r\n        this._dailyTimer = TimerUtil.start(null, this._refreshDaily.bind(this), this._leftTime, 1);\r\n    }\r\n    _refreshDaily() {\r\n        let now = new Date().getTime();\r\n        this._dailyTick = DateUtil.GetNextDay(now).getTime();\r\n        this.saveDailyTicktoCache();\r\n        GameRecorderManager.instance().resetHRecord();\r\n        this._startTimer();\r\n    }\r\n}\r\nDailyManager._instance = null;\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Data/Configuration.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Data/Constants.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Util/DateUtil.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Util/TimerUtil.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/GameRecorderManager.ts"
  ]
}
