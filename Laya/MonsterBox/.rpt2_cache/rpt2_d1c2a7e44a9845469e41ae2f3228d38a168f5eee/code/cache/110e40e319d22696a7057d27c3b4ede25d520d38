{
  "code": "import { Configuration } from \"../../Data/Configuration\";\r\nimport { MiniGameManager } from \"../../Data/MiniGameManager\";\r\nimport { SdkUitl } from \"../../Util/SdkUitl\";\r\nimport DailyManager from \"../Singleton/DailyManager\";\r\nimport GameManager from \"../Singleton/GameManager\";\r\nimport GameRecorderManager from \"../Singleton/GameRecorderManager\";\r\nconst width = 490;\r\nexport default class LoadingPage extends Laya.Script {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._isSubload = false;\r\n        this._enterGame = false;\r\n        this._subTask = null;\r\n    }\r\n    onAwake() {\r\n        this.uiBox = this.owner.getChildAt(0);\r\n        this.progress = this.owner.getChildByName(\"progressBack\").getChildByName(\"progress\");\r\n        this.progress.width = 1;\r\n    }\r\n    onStart() {\r\n        Configuration.instance().init();\r\n        MiniGameManager.instance().loadLevelFromCache();\r\n        GameRecorderManager.instance().loadFromCache();\r\n        SdkUitl.initGameRecorder();\r\n        DailyManager.instance().loadFromCache();\r\n        SdkUitl.passiveShare();\r\n        SdkUitl.createVideoRewardAd();\r\n        this.loadSubPackages();\r\n    }\r\n    onUpdate() {\r\n        if (Laya.timer.delta > 100)\r\n            return;\r\n        if (this._enterGame)\r\n            return;\r\n        this._refreshProgress();\r\n    }\r\n    loadSubPackages() {\r\n        SdkUitl.loadSubpackage(\"sub1\", () => {\r\n            this.subCallback();\r\n        });\r\n        if (this._subTask) {\r\n            this._subTask.onProgressUpdate((res) => {\r\n                this._subProgress = res.progress;\r\n            });\r\n        }\r\n    }\r\n    _refreshProgress() {\r\n        if (this.progress.width <= 0.9 * width) {\r\n            if (this._subTask) {\r\n                this.progress.width = this._subProgress * 0.9 * width;\r\n            }\r\n            else {\r\n                this.progress.width += Laya.timer.delta / 1000 * 0.6 * width;\r\n            }\r\n        }\r\n        else {\r\n            if (this._isSubload) {\r\n                this.progress.width += Laya.timer.delta / 1000 * 0.3 * width;\r\n            }\r\n            if (this.progress.width >= width) {\r\n                this.progress.width = width;\r\n            }\r\n            if (this.progress.width >= width) {\r\n                this.enterGame();\r\n            }\r\n        }\r\n    }\r\n    subCallback() {\r\n        if (!this._isSubload) {\r\n            Laya.Scene.open(\"Scenes/Game.scene\", false);\r\n            this._isSubload = true;\r\n            SdkUitl.loadSubpackage(\"sub2\", null);\r\n        }\r\n    }\r\n    enterGame() {\r\n        if (!this._enterGame && GameManager.instance().isGameReady) {\r\n            console.log(\"enter game!\");\r\n            Laya.Scene.close(\"Scenes/Start.scene\");\r\n            this._enterGame = true;\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Data/Configuration.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Data/MiniGameManager.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Util/SdkUitl.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/Util/WeChatManager.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/DailyManager.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/GameManager.ts",
    "D:/WorkSpace/Laya2.6.1/MonsterBox/src/script/Singleton/GameRecorderManager.ts"
  ]
}
